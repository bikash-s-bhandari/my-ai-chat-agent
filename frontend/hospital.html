<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sunrise Hospital - AI Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
      .message-bubble {
        animation: fadeInUp 0.3s ease-out;
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .typing-indicator {
        display: inline-block;
      }
      
      .typing-indicator span {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #6b7280;
        margin: 0 2px;
        animation: typing 1.4s infinite ease-in-out;
      }
      
      .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
      .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
      
      @keyframes typing {
        0%, 80%, 100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }
      
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>

  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white shadow-lg">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center space-x-3">
          <div class="bg-white bg-opacity-20 p-2 rounded-full">
            <i class="fas fa-hospital text-xl"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold">Sunrise Hospital</h1>
            <p class="text-sm opacity-90">AI Medical Assistant</p>
          </div>
          <div class="ml-auto flex items-center space-x-2">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-sm">Online</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="container mx-auto max-w-4xl px-4 py-6">
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- Chat Messages Area -->
        <div class="h-96 overflow-y-auto p-6 scrollbar-hide" id="chat-container">
          <!-- Welcome Message -->
          <div class="message-bubble max-w-xs bg-blue-50 border border-blue-200 rounded-2xl p-4 mb-4">
            <div class="flex items-start space-x-3">
              <div class="bg-blue-500 text-white p-2 rounded-full">
                <i class="fas fa-robot text-sm"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-blue-900 mb-1">Sunrise Hospital AI</p>
                <p class="text-sm text-blue-800 leading-relaxed">
                  Hello! I'm your AI medical assistant. I can help you with:
                </p>
                <ul class="text-xs text-blue-700 mt-2 space-y-1">
                  <li>• Finding departments and doctors</li>
                  <li>• Checking appointment availability</li>
                  <li>• Booking appointments</li>
                  <li>• General hospital information</li>
                </ul>
                <p class="text-xs text-blue-600 mt-3 italic">
                  How can I assist you today?
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Input Area -->
        <div class="border-t border-gray-200 p-4 bg-gray-50">
          <div class="flex items-end space-x-3">
            <div class="flex-1 bg-white border border-gray-300 rounded-2xl p-3 focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200 transition-all">
              <textarea
                id="input"
                class="w-full resize-none outline-none text-sm text-gray-800 placeholder-gray-500"
                rows="1"
                placeholder="Type your message here..."
              ></textarea>
            </div>
            <button
              id="ask"
              class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-2xl transition-colors duration-200 flex items-center justify-center min-w-[48px]"
            >
              <i class="fas fa-paper-plane text-sm"></i>
            </button>
          </div>
          
          <!-- Quick Actions -->
          <div class="flex flex-wrap gap-2 mt-3">
            <button class="quick-action-btn" data-action="departments">
              <i class="fas fa-building-medical mr-2"></i>
              View Departments
            </button>
            <button class="quick-action-btn" data-action="appointment">
              <i class="fas fa-calendar-check mr-2"></i>
              Book Appointment
            </button>
            <button class="quick-action-btn" data-action="doctors">
              <i class="fas fa-user-md mr-2"></i>
              Find Doctors
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const input = document.querySelector("#input");
      const chatContainer = document.querySelector("#chat-container");
      const askBtn = document.querySelector("#ask");
      const quickActionBtns = document.querySelectorAll(".quick-action-btn");

      // Auto-resize textarea
      input?.addEventListener("input", function() {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 120) + "px";
      });

      input?.addEventListener("keydown", handleEnter);
      askBtn?.addEventListener("click", handleAsk);

      // Quick action buttons
      quickActionBtns.forEach(btn => {
        btn.addEventListener("click", (e) => {
          const action = e.currentTarget.dataset.action;
          let message = "";
          
          switch(action) {
            case "departments":
              message = "What departments do you have?";
              break;
            case "appointment":
              message = "I'd like to book an appointment";
              break;
            case "doctors":
              message = "Can you show me the available doctors?";
              break;
          }
          
          if (message) {
            input.value = message;
            handleAsk();
          }
        });
      });

      function createTypingIndicator() {
        const typingDiv = document.createElement("div");
        typingDiv.className = "message-bubble max-w-xs bg-gray-100 border border-gray-200 rounded-2xl p-4 mb-4";
        typingDiv.innerHTML = `
          <div class="flex items-start space-x-3">
            <div class="bg-gray-500 text-white p-2 rounded-full">
              <i class="fas fa-robot text-sm"></i>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-700 mb-2">Sunrise Hospital AI</p>
              <div class="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        `;
        return typingDiv;
      }

      function createUserMessage(text) {
        const msg = document.createElement("div");
        msg.className = "message-bubble max-w-xs bg-blue-600 text-white rounded-2xl p-4 mb-4 ml-auto";
        msg.innerHTML = `
          <div class="flex items-start space-x-3">
            <div class="flex-1 text-right">
              <p class="text-sm font-medium mb-1">You</p>
              <p class="text-sm leading-relaxed">${escapeHtml(text)}</p>
            </div>
            <div class="bg-blue-700 text-white p-2 rounded-full">
              <i class="fas fa-user text-sm"></i>
            </div>
          </div>
        `;
        return msg;
      }

      function createAssistantMessage(text) {
        const msg = document.createElement("div");
        msg.className = "message-bubble max-w-xs bg-blue-50 border border-blue-200 rounded-2xl p-4 mb-4";
        msg.innerHTML = `
          <div class="flex items-start space-x-3">
            <div class="bg-blue-500 text-white p-2 rounded-full">
              <i class="fas fa-robot text-sm"></i>
            </div>
            <div class="flex-1">
              <p class="text-sm font-medium text-blue-900 mb-1">Sunrise Hospital AI</p>
              <p class="text-sm text-blue-800 leading-relaxed">${escapeHtml(text)}</p>
            </div>
          </div>
        `;
        return msg;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function scrollToBottom() {
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      async function generate(text) {
        // Add user message
        const userMsg = createUserMessage(text);
        chatContainer?.appendChild(userMsg);
        scrollToBottom();

        // Clear input and reset height
        input.value = "";
        input.style.height = "auto";

        // Add typing indicator
        const typingIndicator = createTypingIndicator();
        chatContainer?.appendChild(typingIndicator);
        scrollToBottom();

        try {
          // Call server
          const assistantMessage = await callServer(text);

          // Remove typing indicator
          typingIndicator.remove();

          // Add assistant message
          const assistantMsg = createAssistantMessage(assistantMessage);
          chatContainer?.appendChild(assistantMsg);
          scrollToBottom();
        } catch (error) {
          // Remove typing indicator
          typingIndicator.remove();

          // Show error message
          const errorMsg = createAssistantMessage("I apologize, but I'm experiencing technical difficulties. Please try again in a moment.");
          chatContainer?.appendChild(errorMsg);
          scrollToBottom();
        }
      }

      async function callServer(inputText) {
        const response = await fetch("http://localhost:3001/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ message: inputText }),
        });

        if (!response.ok) {
          throw new Error("Error generating the response.");
        }

        const result = await response.json();
        return result.message;
      }

      async function handleAsk(e) {
        const text = input?.value.trim();
        if (!text) {
          return;
        }

        await generate(text);
      }

      async function handleEnter(e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          const text = input?.value.trim();
          if (!text) {
            return;
          }

          await generate(text);
        }
      }

      // Add CSS for quick action buttons
      const style = document.createElement('style');
      style.textContent = `
        .quick-action-btn {
          @apply bg-white border border-gray-300 text-gray-700 px-3 py-2 rounded-xl text-xs font-medium hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 flex items-center;
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
